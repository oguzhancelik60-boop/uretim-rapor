<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4F46E5">
    <title>Ãœretim Rapor Sistemi</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div id="app"></div>
    
    <script>
    const USERS = {
        'yonetici': { password: 'admin123', role: 'YÃ¶netici', name: 'YÃ¶netici', isAdmin: true },
        'ali': { password: 'ali123', role: 'OperatÃ¶r', name: 'Ali', isAdmin: false }
    };

    let state = {
        lang: localStorage.getItem('lang') || 'tr',
        loggedIn: false,
        user: null,
        tab: 'giris',
        shift: 'sabah',
        date: new Date().toISOString().split('T')[0],
        machines: [
            { id: 1, en: '', boy: '', kalinlik: '', qp: '', qd: '' },
            { id: 2, en: '', boy: '', kalinlik: '', qp: '', qd: '' },
            { id: 3, en: '', boy: '', kalinlik: '', qp: '', qd: '' },
            { id: 4, en: '', boy: '', kalinlik: '', qp: '', qd: '' }
        ],
        reports: JSON.parse(localStorage.getItem('reports') || '[]'),
        filterStart: '',
        filterEnd: '',
        filtering: false
    };

    const T = {
        tr: { title: 'Ãœretim Rapor Sistemi', login: 'GiriÅŸ Yap', logout: 'Ã‡Ä±kÄ±ÅŸ', username: 'KullanÄ±cÄ± AdÄ±', password: 'Åifre', welcome: 'HoÅŸ geldiniz', dataEntry: 'Veri GiriÅŸi', reports: 'Raporlar', settings: 'Ayarlar', shift: 'Vardiya', morning: 'Sabah', evening: 'AkÅŸam', machine: 'Makine', width: 'En (mm)', length: 'Boy (mm)', thickness: 'KalÄ±nlÄ±k (mm)', poperechny: 'ĞŸĞ¾Ğ¿ĞµÑ€ĞµÑ‡Ğ½Ñ‹Ğ¹', prodolny: 'ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹', save: 'Raporu Kaydet', saved: 'Rapor kaydedildi!', total: 'Toplam', grandTotal: 'Genel Toplam', volume: 'Hacim', qty: 'Adet', noReports: 'HenÃ¼z rapor yok', deleteAll: 'TÃ¼mÃ¼nÃ¼ Sil', confirmDelete: 'Emin misiniz?', filter: 'Filtrele', showAll: 'TÃ¼mÃ¼', startDate: 'BaÅŸlangÄ±Ã§', endDate: 'BitiÅŸ', exportExcel: 'Excel', reportDate: 'Rapor Tarihi', demo: 'Demo: yonetici/admin123' },
        ru: { title: 'Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞÑ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ²', login: 'Ğ’Ğ¾Ğ¹Ñ‚Ğ¸', logout: 'Ğ’Ñ‹Ñ…Ğ¾Ğ´', username: 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ', password: 'ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ', welcome: 'Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ', dataEntry: 'Ğ’Ğ²Ğ¾Ğ´ Ğ”Ğ°Ğ½Ğ½Ñ‹Ñ…', reports: 'ĞÑ‚Ñ‡Ñ‘Ñ‚Ñ‹', settings: 'ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸', shift: 'Ğ¡Ğ¼ĞµĞ½Ğ°', morning: 'Ğ£Ñ‚Ñ€ĞµĞ½Ğ½ÑÑ', evening: 'Ğ’ĞµÑ‡ĞµÑ€Ğ½ÑÑ', machine: 'ĞœĞ°ÑˆĞ¸Ğ½Ğ°', width: 'Ğ¨Ğ¸Ñ€Ğ¸Ğ½Ğ° (Ğ¼Ğ¼)', length: 'Ğ”Ğ»Ğ¸Ğ½Ğ° (Ğ¼Ğ¼)', thickness: 'Ğ¢Ğ¾Ğ»Ñ‰Ğ¸Ğ½Ğ° (Ğ¼Ğ¼)', poperechny: 'ĞŸĞ¾Ğ¿ĞµÑ€ĞµÑ‡Ğ½Ñ‹Ğ¹', prodolny: 'ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹', save: 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ', saved: 'Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾!', total: 'Ğ˜Ñ‚Ğ¾Ğ³Ğ¾', grandTotal: 'ĞĞ±Ñ‰Ğ¸Ğ¹ ĞĞ±ÑŠÑ‘Ğ¼', volume: 'ĞĞ±ÑŠÑ‘Ğ¼', qty: 'ĞšĞ¾Ğ»-Ğ²Ğ¾', noReports: 'ĞĞµÑ‚ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ²', deleteAll: 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ', confirmDelete: 'Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹?', filter: 'Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€', showAll: 'Ğ’ÑĞµ', startDate: 'ĞĞ°Ñ‡Ğ°Ğ»Ğ¾', endDate: 'ĞšĞ¾Ğ½ĞµÑ†', exportExcel: 'Excel', reportDate: 'Ğ”Ğ°Ñ‚Ğ° ĞÑ‚Ñ‡Ñ‘Ñ‚Ğ°', demo: 'Ğ”ĞµĞ¼Ğ¾: yonetici/admin123' },
        kk: { title: 'Ğ•ÑĞµĞ¿ Ğ–Ò¯Ğ¹ĞµÑÑ–', login: 'ĞšÑ–Ñ€Ñƒ', logout: 'Ğ¨Ñ‹Ò“Ñƒ', username: 'ĞŸĞ°Ğ¹Ğ´Ğ°Ğ»Ğ°Ğ½ÑƒÑˆÑ‹', password: 'ÒšÒ±Ğ¿Ğ¸Ñ ÑÓ©Ğ·', welcome: 'ÒšĞ¾Ñˆ ĞºĞµĞ»Ğ´Ñ–Ò£Ñ–Ğ·', dataEntry: 'Ğ”ĞµÑ€ĞµĞºÑ‚ĞµÑ€', reports: 'Ğ•ÑĞµĞ¿Ñ‚ĞµÑ€', settings: 'Ğ‘Ğ°Ğ¿Ñ‚Ğ°ÑƒĞ»Ğ°Ñ€', shift: 'ĞÑƒÑ‹ÑÑ‹Ğ¼', morning: 'Ğ¢Ğ°Ò£Ò“Ñ‹', evening: 'ĞšĞµÑˆĞºÑ–', machine: 'ĞœĞ°ÑˆĞ¸Ğ½Ğ°', width: 'Ğ•Ğ½Ñ– (Ğ¼Ğ¼)', length: 'Ò°Ğ·Ñ‹Ğ½Ğ´Ñ‹Ò“Ñ‹ (Ğ¼Ğ¼)', thickness: 'ÒšĞ°Ğ»Ñ‹Ò£Ğ´Ñ‹Ò“Ñ‹ (Ğ¼Ğ¼)', poperechny: 'ĞšÓ©Ğ»Ğ´ĞµĞ½ĞµÒ£', prodolny: 'Ğ‘Ğ¾Ğ¹Ğ»Ñ‹Ò›', save: 'Ğ¡Ğ°Ò›Ñ‚Ğ°Ñƒ', saved: 'Ğ¡Ğ°Ò›Ñ‚Ğ°Ğ»Ğ´Ñ‹!', total: 'Ğ–Ğ¸Ñ‹Ğ½Ñ‹', grandTotal: 'Ğ–Ğ°Ğ»Ğ¿Ñ‹ ĞšÓ©Ğ»ĞµĞ¼', volume: 'ĞšÓ©Ğ»ĞµĞ¼', qty: 'Ğ¡Ğ°Ğ½Ñ‹', noReports: 'Ğ•ÑĞµĞ¿ Ğ¶Ğ¾Ò›', deleteAll: 'Ğ‘Ğ°Ñ€Ğ»Ñ‹Ò“Ñ‹Ğ½ Ğ¶Ğ¾Ñ', confirmDelete: 'Ğ¡ĞµĞ½Ñ–Ğ¼Ğ´Ñ–ÑÑ–Ğ· Ğ±Ğµ?', filter: 'Ğ¡Ò¯Ğ·Ñƒ', showAll: 'Ğ‘Ğ°Ñ€Ğ»Ñ‹Ò“Ñ‹', startDate: 'Ğ‘Ğ°ÑÑ‹', endDate: 'Ğ¡Ğ¾Ò£Ñ‹', exportExcel: 'Excel', reportDate: 'Ğ•ÑĞµĞ¿ ĞšÒ¯Ğ½Ñ–', demo: 'Ğ”ĞµĞ¼Ğ¾: yonetici/admin123' }
    };

    const t = (key) => T[state.lang][key] || key;

    function calcVol(m, type) {
        const en = parseFloat(m.en) || 0;
        const boy = parseFloat(m.boy) || 0;
        const kalinlik = parseFloat(m.kalinlik) || 0;
        const qty = parseFloat(type === 'p' ? m.qp : m.qd) || 0;
        return ((en/1000) * (boy/1000) * (kalinlik/1000) * qty).toFixed(3);
    }

    function totalVol(type) {
        return state.machines.reduce((sum, m) => sum + parseFloat(calcVol(m, type)), 0).toFixed(3);
    }

    function totalQty(type) {
        return state.machines.reduce((sum, m) => sum + (parseFloat(type === 'p' ? m.qp : m.qd) || 0), 0);
    }

    function grandTotal() {
        return (parseFloat(totalVol('p')) + parseFloat(totalVol('d'))).toFixed(3);
    }

    function exportExcel(rpts) {
        let csv = '\uFEFF' + `Tarih,Vardiya,KullanÄ±cÄ±,Makine,En,Boy,KalÄ±nlÄ±k,ĞŸĞ¾Ğ¿ĞµÑ€ĞµÑ‡Ğ½Ñ‹Ğ¹ Adet,ĞŸĞ¾Ğ¿ĞµÑ€ĞµÑ‡Ğ½Ñ‹Ğ¹ mÂ³,ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ Adet,ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¹ mÂ³\n`;
        rpts.forEach(r => {
            r.machines.forEach(m => {
                csv += `${r.date},${r.shift},${r.user},Makine ${m.id},${m.en},${m.boy},${m.kalinlik},${m.qp},${m.vp},${m.qd},${m.vd}\n`;
            });
            csv += `${r.date},${r.shift},${r.user},TOPLAM,,,,${r.tqp},${r.tvp},${r.tqd},${r.tvd}\n`;
            csv += `${r.date},${r.shift},${r.user},GENEL TOPLAM,,,,${r.tqp+r.tqd},${r.gt},,\n\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'rapor_' + new Date().toISOString().split('T')[0] + '.csv';
        link.click();
    }

    function shareWhatsApp(r) {
        let msg = `*${t('title')}*\nğŸ“… ${r.date}\nâ° ${r.shift === 'sabah' ? t('morning') : t('evening')}\nğŸ‘¤ ${r.user}\n\n`;
        r.machines.forEach(m => {
            msg += `*${t('machine')} ${m.id}*\n${t('width')}: ${m.en} | ${t('length')}: ${m.boy} | ${t('thickness')}: ${m.kalinlik}\nğŸ”µ ${t('poperechny')}: ${m.qp} (${m.vp} mÂ³)\nğŸŸ¢ ${t('prodolny')}: ${m.qd} (${m.vd} mÂ³)\n\n`;
        });
        msg += `*${t('grandTotal')}*\nğŸ”µ ${t('poperechny')}: ${r.tqp} â†’ ${r.tvp} mÂ³\nğŸŸ¢ ${t('prodolny')}: ${r.tqd} â†’ ${r.tvd} mÂ³\nğŸ“Š ${t('total')}: ${r.gt} mÂ³`;
        window.open('https://wa.me/?text=' + encodeURIComponent(msg), '_blank');
    }

    function render() {
        const app = document.getElementById('app');
        
        // LOGIN SCREEN
        if (!state.loggedIn) {
            app.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-blue-600 to-indigo-800 flex items-center justify-center p-4">
                    <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-8">
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-4">ğŸ­</div>
                            <h1 class="text-2xl font-bold text-gray-800">${t('title')}</h1>
                            <div class="flex justify-center gap-2 mt-4">
                                <button onclick="changeLang('tr')" class="px-3 py-1 rounded ${state.lang==='tr'?'bg-indigo-600 text-white':'bg-gray-200'}">ğŸ‡¹ğŸ‡·</button>
                                <button onclick="changeLang('ru')" class="px-3 py-1 rounded ${state.lang==='ru'?'bg-indigo-600 text-white':'bg-gray-200'}">ğŸ‡·ğŸ‡º</button>
                                <button onclick="changeLang('kk')" class="px-3 py-1 rounded ${state.lang==='kk'?'bg-indigo-600 text-white':'bg-gray-200'}">ğŸ‡°ğŸ‡¿</button>
                            </div>
                        </div>
                        <div id="loginError" class="hidden bg-red-100 text-red-700 p-3 rounded mb-4"></div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">${t('username')}</label>
                                <input id="username" type="text" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="${t('username')}">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">${t('password')}</label>
                                <input id="password" type="password" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="${t('password')}">
                            </div>
                            <button onclick="login()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700">${t('login')}</button>
                        </div>
                        <p class="text-center text-sm text-gray-500 mt-4">${t('demo')}</p>
                    </div>
                </div>
            `;
            return;
        }

        // MAIN APP
        const filteredReports = state.filtering ? state.reports.filter(r => {
            const rt = r.ts || new Date(r.date).getTime();
            const start = state.filterStart ? new Date(state.filterStart).setHours(0,0,0,0) : 0;
            const end = state.filterEnd ? new Date(state.filterEnd).setHours(23,59,59,999) : Date.now() + 86400000;
            return rt >= start && rt <= end;
        }) : state.reports;

        let machinesHTML = state.machines.map(m => `
            <div class="bg-white rounded-lg shadow p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <span class="font-bold text-lg">${t('machine')} ${m.id}</span>
                    <div class="text-sm">
                        <span class="text-blue-600">${t('poperechny')}: ${calcVol(m,'p')} mÂ³</span> | 
                        <span class="text-green-600">${t('prodolny')}: ${calcVol(m,'d')} mÂ³</span>
                    </div>
                </div>
                <div class="grid grid-cols-5 gap-2">
                    <div>
                        <label class="text-xs">${t('width')}</label>
                        <input type="number" value="${m.en}" onchange="updateMachine(${m.id},'en',this.value)" class="w-full p-2 border rounded" inputmode="numeric">
                    </div>
                    <div>
                        <label class="text-xs">${t('length')}</label>
                        <input type="number" value="${m.boy}" onchange="updateMachine(${m.id},'boy',this.value)" class="w-full p-2 border rounded" inputmode="numeric">
                    </div>
                    <div>
                        <label class="text-xs">${t('thickness')}</label>
                        <input type="number" value="${m.kalinlik}" onchange="updateMachine(${m.id},'kalinlik',this.value)" class="w-full p-2 border rounded" inputmode="decimal">
                    </div>
                    <div>
                        <label class="text-xs text-blue-600">${t('poperechny')}</label>
                        <input type="number" value="${m.qp}" onchange="updateMachine(${m.id},'qp',this.value)" class="w-full p-2 border border-blue-300 rounded" inputmode="numeric">
                    </div>
                    <div>
                        <label class="text-xs text-green-600">${t('prodolny')}</label>
                        <input type="number" value="${m.qd}" onchange="updateMachine(${m.id},'qd',this.value)" class="w-full p-2 border border-green-300 rounded" inputmode="numeric">
                    </div>
                </div>
            </div>
        `).join('');

        let reportsHTML = filteredReports.length === 0 ? `<p class="text-center text-gray-500 py-8">${t('noReports')}</p>` : 
            filteredReports.slice().reverse().map(r => `
                <div class="bg-white rounded-lg shadow p-4 mb-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <div class="font-bold">${r.date}</div>
                            <div class="text-sm text-gray-600">${r.shift === 'sabah' ? t('morning') : t('evening')} | ${r.user}</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick='shareWhatsApp(${JSON.stringify(r).replace(/'/g, "\\'")})' class="bg-green-500 text-white px-2 py-1 rounded text-sm">ğŸ“±</button>
                            <button onclick='exportExcel([${JSON.stringify(r).replace(/'/g, "\\'")}])' class="bg-blue-500 text-white px-2 py-1 rounded text-sm">ğŸ“Š</button>
                            ${state.user.isAdmin ? `<button onclick="deleteReport(${r.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">ğŸ—‘ï¸</button>` : ''}
                        </div>
                    </div>
                    ${r.machines.map(m => `
                        <div class="border-l-4 border-indigo-400 pl-3 py-2 mb-2 text-sm">
                            <div class="font-medium">${t('machine')} ${m.id}</div>
                            <div>${t('width')}: ${m.en} | ${t('length')}: ${m.boy} | ${t('thickness')}: ${m.kalinlik}</div>
                            <div><span class="text-blue-600">${t('poperechny')}: ${m.qp} (${m.vp} mÂ³)</span> | <span class="text-green-600">${t('prodolny')}: ${m.qd} (${m.vd} mÂ³)</span></div>
                        </div>
                    `).join('')}
                    <div class="border-t pt-3 mt-3 grid grid-cols-2 gap-2">
                        <div class="bg-blue-50 p-2 rounded"><span class="text-blue-700 font-medium">${t('poperechny')}:</span> ${r.tqp} ${t('qty')} â†’ ${r.tvp} mÂ³</div>
                        <div class="bg-green-50 p-2 rounded"><span class="text-green-700 font-medium">${t('prodolny')}:</span> ${r.tqd} ${t('qty')} â†’ ${r.tvd} mÂ³</div>
                    </div>
                    <div class="bg-indigo-100 p-3 rounded mt-2 text-center">
                        <span class="font-bold text-indigo-900">${t('grandTotal')}: ${r.gt} mÂ³</span>
                    </div>
                </div>
            `).join('');

        app.innerHTML = `
            <div class="min-h-screen bg-gray-100">
                <div class="bg-indigo-700 text-white p-4">
                    <div class="max-w-4xl mx-auto flex justify-between items-center">
                        <div>
                            <h1 class="text-xl font-bold">ğŸ­ ${t('title')}</h1>
                            <p class="text-sm opacity-80">${t('welcome')}, ${state.user.name}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="changeLang('tr')" class="px-2 py-1 rounded ${state.lang==='tr'?'bg-white text-indigo-700':'bg-indigo-600'}">ğŸ‡¹ğŸ‡·</button>
                            <button onclick="changeLang('ru')" class="px-2 py-1 rounded ${state.lang==='ru'?'bg-white text-indigo-700':'bg-indigo-600'}">ğŸ‡·ğŸ‡º</button>
                            <button onclick="changeLang('kk')" class="px-2 py-1 rounded ${state.lang==='kk'?'bg-white text-indigo-700':'bg-indigo-600'}">ğŸ‡°ğŸ‡¿</button>
                            <button onclick="logout()" class="bg-red-500 px-3 py-1 rounded">${t('logout')}</button>
                        </div>
                    </div>
                </div>

                <div class="max-w-4xl mx-auto p-4">
                    <div class="flex gap-2 mb-4">
                        <button onclick="setTab('giris')" class="flex-1 py-2 rounded ${state.tab==='giris'?'bg-indigo-600 text-white':'bg-white'}">${t('dataEntry')}</button>
                        <button onclick="setTab('raporlar')" class="flex-1 py-2 rounded ${state.tab==='raporlar'?'bg-indigo-600 text-white':'bg-white'}">${t('reports')}</button>
                        ${state.user.isAdmin ? `<button onclick="setTab('ayarlar')" class="flex-1 py-2 rounded ${state.tab==='ayarlar'?'bg-indigo-600 text-white':'bg-white'}">${t('settings')}</button>` : ''}
                    </div>

                    ${state.tab === 'giris' ? `
                        <div class="bg-white rounded-lg shadow p-4 mb-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">${t('shift')}</label>
                                    <div class="flex gap-2">
                                        <button onclick="setShift('sabah')" class="flex-1 py-2 rounded ${state.shift==='sabah'?'bg-indigo-600 text-white':'bg-gray-200'}">${t('morning')}</button>
                                        <button onclick="setShift('aksam')" class="flex-1 py-2 rounded ${state.shift==='aksam'?'bg-indigo-600 text-white':'bg-gray-200'}">${t('evening')}</button>
                                    </div>
                                </div>
                                ${state.user.isAdmin ? `
                                    <div>
                                        <label class="block text-sm font-medium mb-2">${t('reportDate')}</label>
                                        <input type="date" value="${state.date}" onchange="setDate(this.value)" class="w-full p-2 border rounded">
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        ${machinesHTML}

                        <div class="bg-gradient-to-r from-indigo-100 to-purple-100 rounded-lg shadow p-4">
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div class="bg-blue-50 p-3 rounded border-2 border-blue-200">
                                    <div class="text-sm text-blue-700">${t('poperechny')} ${t('total')}</div>
                                    <div class="text-xl font-bold text-blue-800">${totalVol('p')} mÂ³</div>
                                    <div class="text-xs text-blue-600">${t('qty')}: ${totalQty('p')}</div>
                                </div>
                                <div class="bg-green-50 p-3 rounded border-2 border-green-200">
                                    <div class="text-sm text-green-700">${t('prodolny')} ${t('total')}</div>
                                    <div class="text-xl font-bold text-green-800">${totalVol('d')} mÂ³</div>
                                    <div class="text-xs text-green-600">${t('qty')}: ${totalQty('d')}</div>
                                </div>
                            </div>
                            <div class="bg-indigo-200 p-4 rounded mb-4 text-center">
                                <div class="text-lg font-bold text-indigo-900">${t('grandTotal')}: ${grandTotal()} mÂ³</div>
                                <div class="text-sm text-indigo-700">${t('qty')}: ${totalQty('p') + totalQty('d')}</div>
                            </div>
                            <button onclick="saveReport()" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">ğŸ’¾ ${t('save')}</button>
                        </div>
                    ` : ''}

                    ${state.tab === 'raporlar' ? `
                        <div class="bg-white rounded-lg shadow p-4 mb-4">
                            <div class="grid grid-cols-3 gap-2 mb-3">
                                <input type="date" value="${state.filterStart}" onchange="setFilterStart(this.value)" class="p-2 border rounded" placeholder="${t('startDate')}">
                                <input type="date" value="${state.filterEnd}" onchange="setFilterEnd(this.value)" class="p-2 border rounded" placeholder="${t('endDate')}">
                                <div class="flex gap-1">
                                    <button onclick="applyFilter()" class="flex-1 bg-indigo-600 text-white rounded">${t('filter')}</button>
                                    ${state.filtering ? `<button onclick="clearFilter()" class="flex-1 bg-gray-500 text-white rounded">${t('showAll')}</button>` : ''}
                                </div>
                            </div>
                            ${filteredReports.length > 0 ? `<button onclick='exportExcel(${JSON.stringify(filteredReports).replace(/'/g, "\\'")})' class="w-full bg-green-600 text-white py-2 rounded">ğŸ“Š ${t('exportExcel')} (${filteredReports.length})</button>` : ''}
                        </div>
                        ${reportsHTML}
                    ` : ''}

                    ${state.tab === 'ayarlar' && state.user.isAdmin ? `
                        <div class="bg-white rounded-lg shadow p-4">
                            <h3 class="font-bold text-red-700 mb-2">âš ï¸ ${t('settings')}</h3>
                            <p class="text-sm text-gray-600 mb-4">${t('reports')}: ${state.reports.length}</p>
                            <button onclick="deleteAllReports()" class="w-full bg-red-600 text-white py-2 rounded">ğŸ—‘ï¸ ${t('deleteAll')}</button>
                        </div>
                    ` : ''}
                </div>
            </div>

            <div id="successMsg" class="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded shadow-lg hidden">âœ… ${t('saved')}</div>
        `;
    }

    // GLOBAL FUNCTIONS
    window.changeLang = (l) => { state.lang = l; localStorage.setItem('lang', l); render(); };
    window.login = () => {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        const user = USERS[u];
        if (!user || user.password !== p) {
            document.getElementById('loginError').textContent = 'KullanÄ±cÄ± veya ÅŸifre hatalÄ±!';
            document.getElementById('loginError').classList.remove('hidden');
            return;
        }
        state.user = user;
        state.loggedIn = true;
        render();
    };
    window.logout = () => { state.loggedIn = false; state.user = null; state.tab = 'giris'; render(); };
    window.setTab = (t) => { state.tab = t; render(); };
    window.setShift = (s) => { state.shift = s; render(); };
    window.setDate = (d) => { state.date = d; render(); };
    window.updateMachine = (id, field, val) => {
        state.machines = state.machines.map(m => m.id === id ? {...m, [field]: val} : m);
        render();
    };
    window.saveReport = () => {
        const r = {
            id: Date.now(),
            date: state.date + ' ' + new Date().toTimeString().slice(0,5),
            ts: new Date(state.date).getTime(),
            shift: state.shift,
            user: state.user.name,
            machines: state.machines.map(m => ({...m, vp: calcVol(m,'p'), vd: calcVol(m,'d')})),
            tvp: totalVol('p'),
            tvd: totalVol('d'),
            tqp: totalQty('p'),
            tqd: totalQty('d'),
            gt: grandTotal()
        };
        state.reports.push(r);
        localStorage.setItem('reports', JSON.stringify(state.reports));
        state.machines = [
            { id: 1, en: '', boy: '', kalinlik: '', qp: '', qd: '' },
            { id: 2, en: '', boy: '', kalinlik: '', qp: '', qd: '' },
            { id: 3, en: '', boy: '', kalinlik: '', qp: '', qd: '' },
            { id: 4, en: '', boy: '', kalinlik: '', qp: '', qd: '' }
        ];
        render();
        document.getElementById('successMsg').classList.remove('hidden');
        setTimeout(() => document.getElementById('successMsg').classList.add('hidden'), 3000);
    };
    window.deleteReport = (id) => {
        state.reports = state.reports.filter(r => r.id !== id);
        localStorage.setItem('reports', JSON.stringify(state.reports));
        render();
    };
    window.deleteAllReports = () => {
        if (confirm(t('confirmDelete'))) {
            state.reports = [];
            localStorage.setItem('reports', '[]');
            render();
        }
    };
    window.setFilterStart = (d) => { state.filterStart = d; };
    window.setFilterEnd = (d) => { state.filterEnd = d; };
    window.applyFilter = () => { state.filtering = true; render(); };
    window.clearFilter = () => { state.filterStart = ''; state.filterEnd = ''; state.filtering = false; render(); };
    window.exportExcel = exportExcel;
    window.shareWhatsApp = shareWhatsApp;

    // INIT
    render();
    </script>
</body>
</html>
